# jest-changed-files

A module used internally by Jest to check which files have changed since you
last committed in git or hg.

## Install

```sh
$ npm install --save jest-changed-files
```

## API

<<<<<<< HEAD
### `getChangedFilesForRoots(roots: <Array<string>>, options: ?object): Promise<?object>`

Get the list of files and repos that have changed since the last commit.

#### Parameters

roots: Array of string paths gathered from
[jest roots](https://facebook.github.io/jest/docs/configuration.html#roots-array-string).

options: Object literal with keys

* lastCommit: boolean
* withAncestor: boolean

### findRepos(roots: <Array

<string>>): Promise<?object>

Get a set of git and hg repositories.

#### Parameters

roots: Array of string paths gathered from
[jest roots](https://facebook.github.io/jest/docs/configuration.html#roots-array-string).
=======
### `hg.isHGRepository(cwd: string): Promise<?string>`

Get the root of the mercurial repository containing `cwd` or return `null` if
`cwd` is not inside a mercurial repository.

### `git.isGitRepository(cwd: string): Promise<?string>`

Get the root of the git repository containing `cwd` or return `null` if
`cwd` is not inside a git repository.

### `hg.findChangedFiles / git.findChangedFiles (root: string): Promise<Array<string>>`

Get the list of files in a git/mecurial repository that have changed since the
last commit.
>>>>>>> master

## Usage

```javascript
<<<<<<< HEAD
import {getChangedFilesForRoots} from 'jest-changed-files';

getChangedFilesForRoots(['/path/to/test'], {
  lastCommit: true,
  withAncestor: true,
}).then(files => {
  /*
  {
    repos: [],
    changedFiles: []
  }
  */
});
```

```javascript
import {findRepos} from 'jest-changed-files';

findRepos(['/path/to/test']).then(repos => {
  /*
  {
    git: Set<Path>,
    hg: Set<Path>
  }
  */
});
=======
import {git, hg} from 'jest-changed-files';

function changedFiles(cwd) {
  return Promise.all([
    git.isGitRepository(cwd),
    hg.isHGRepository(cwd),
  ]).then(([gitRoot, hgRoot]) => {
    if (gitRoot !== null) {
      return git.findChangedFiles(gitRoot);
    } else if (hgRoot !== null) {
      return hg.findChangedFiles(hgRoot);
    } else {
      throw new Error('Not in a git or hg repo');
    }
  });
}
>>>>>>> master
```
